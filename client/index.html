<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>Tetris Online Server</title>
		<style>
			html, body {
				height: 100%;
				width: 100%;
			}

			#menuContainer {
				height: 50%;
				width: 70%;
				background-color: #C6C6E9;
				color: #1914EF;
			}
		</style>
	</head>
	<body>
		<h1>Tetris</h1>
		<div id="menuContainer"></div>
		<div class="newRoomContainer">
			<a href="/room">Create New Room</a>
		</div>

		<script>
			const menuContainer = document.getElementById('menuContainer'); 
			window.addEventListener('load', getMenuData)

			const updateChecker = setInterval(getMenuData, 1000)

			function getMenuData(event) {
				var req = new XMLHttpRequest();
				req.open('GET', '/menu-update', true);

				req.onload = function() {
				  if (req.status >= 200 && req.status < 400) {
				    // Success!
				    var data = JSON.parse(req.responseText);
				    updateMenu(data)

				  } else {
				    // We reached our target server, but it returned an error

				  }
				};

				req.onerror = function() {
				  // There was a connection error of some sort
				};

				req.send();		
			}

			function updateMenu(array = []) {
				let content = '';
				if(array.length) {
					//loop through array and create divs representing rooms with links
					for (let i = 0; i < array.length; i++) {
						const room =
									 `<div class="roomContainer">
										<div class="roomName">
											Room: ${array[i].room}
										</div>
										<div class="roomPop">
											Players: ${array[i].pop} / 5
										</div>
										<div class="roomLink">
											<a href="/room#${array[i].room}">PLAY</a>
										</div>
									</div>`;
						content += room
					}
				} else {
					//create single div showing no rooms available
					content=`<div class='roomContainer'>NO ROOMS ACTIVE</div>`
				}
				menuContainer.innerHTML = content;
			}

		</script>
	</body>
</html>